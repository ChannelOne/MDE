"use strict";
const ViewLine_1 = require("./ViewLine");
const textModel_1 = require("../model/textModel");
const lineNumber_1 = require("./lineNumber");
const dom_1 = require("../util/dom");
const util_1 = require("../util/util");
class Display {
    constructor(container) {
        this._model = new textModel_1.TextModel();
        this._model.setFromRawText("");
        this._lineNumber = new lineNumber_1.LineNumber(0);
        this._frame = dom_1.elem("div", "display-frame");
        this._render_frame = dom_1.elem("div", "render-frame");
        this._cursor = dom_1.elem("div", "cursor");
        this._input = (dom_1.elem("textarea", "input-textarea"));
        this._frame.appendChild(this._cursor);
        this._frame.appendChild(this._lineNumber.frame);
        this._frame.appendChild(this._render_frame);
        container.appendChild(this._frame);
        this._cursor.style.position = "absolute";
        let _cursor_shown = false;
        setInterval(() => {
            if (_cursor_shown) {
                this._cursor.style.opacity = "0";
            }
            else {
                this._cursor.style.opacity = "1";
            }
            _cursor_shown = !_cursor_shown;
        }, 500);
    }
    render(tm) {
        this._lines = new Array();
        try {
            this._lineNumber.total_number = tm.linesCount;
        }
        catch (e) {
            console.log(e);
        }
        let lineCount = tm.linesCount;
        for (let i = 1; i <= lineCount; i++) {
            let vl = new ViewLine_1.ViewLine(tm.getLineFromNum(i));
            vl.onClickEvent((vl, e) => {
                let offset = util_1.insertBreakAtPoint(e);
                let range = document.caretRangeFromPoint(e.pageX, e.pageY);
                let coordinate = range.getBoundingClientRect();
                this._cursor.style.top = coordinate.top.toString() + "px";
                this._cursor.style.left = coordinate.left.toString() + "px";
            });
            this._lines.push(vl);
        }
        for (let i = 0; i < this._lines.length; ++i) {
            this._render_frame.appendChild(this._lines[i].element);
        }
    }
    get frame() {
        return this._frame;
    }
}
exports.Display = Display;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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
